{% extends 'base.html.twig' %}

{% block title %}
    {{ parent() }} index
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>

    <style>
        #indexMap {
            height: 400px;
        }
    </style>
{% endblock %}


{% block body %}

    <h1>Home</h1>

    <div class="col-xs-offset-1 col-xs-10" id="indexMap"></div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}


    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script>


    <script>

        var trace = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                            [
                                -1.476043369211311,
                                48.00590438683001
                            ],
                            [
                                -1.475120689310188,
                                48.00422466748777
                            ],
                            [
                                -1.4745842475072095,
                                48.00227210446322
                            ],
                            [
                                -1.4744823235646436,
                                48.00165473459902
                            ],
                            [
                                -1.4741444532569403,
                                48.00002858889421
                            ],
                            [
                                -1.4734363500770087,
                                47.99845636643422
                            ],
                            [
                                -1.4732217733558173,
                                47.996711789545074
                            ],
                            [
                                -1.4731895868476386,
                                47.99615348852383
                            ],
                            [
                                -1.4730930273231024,
                                47.995995538669845
                            ],
                            [
                                -1.4726960603888983,
                                47.99552886582193
                            ],
                            [
                                -1.4725458566840643,
                                47.995291937991425
                            ],
                            [
                                -1.4725136701758856,
                                47.99509090746389
                            ],
                            [
                                -1.4727175180610175,
                                47.99502988018449
                            ],
                            [
                                -1.4745628778632636,
                                47.994588327718446
                            ],
                            [
                                -1.4748632852729315,
                                47.994475269835384
                            ],
                            [
                                -1.4752548877891059,
                                47.99427423612605
                            ],
                            [
                                -1.475802058428144,
                                47.99400140341063
                            ],
                            [
                                -1.4760810081656928,
                                47.993911655491544
                            ],
                            [
                                -1.4764350597556586,
                                47.99386498651194
                            ],
                            [
                                -1.4797978224510189,
                                47.99360868379873
                            ],
                            [
                                -1.4805059256309505,
                                47.993493805560014
                            ],
                            [
                                -1.4825444044822689,
                                47.9933825170224
                            ],
                            [
                                -1.4826624216789241,
                                47.9940897336455
                            ],
                            [
                                -1.4825497689002987,
                                47.9944379534976
                            ],
                            [
                                -1.482040149187469,
                                47.99532105722481
                            ],
                            [
                                -1.481916767572784,
                                47.99585181107338
                            ],
                            [
                                -1.4817343773597713,
                                47.99678514670654
                            ],
                            [
                                -1.481718284105682,
                                47.99725898756636
                            ],
                            [
                                -1.481671344010124,
                                47.99750937243734
                            ],
                            [
                                -1.4815372335593793,
                                47.99776423834797
                            ],
                            [
                                -1.4808291303794476,
                                47.998528828525785
                            ],
                            [
                                -1.4807325708549115,
                                47.998952399427644
                            ],
                            [
                                -1.4808023082892987,
                                48.00008669081851
                            ],
                            [
                                -1.4806628334205243,
                                48.001059433507244
                            ],
                            [
                                -1.4804423468274308,
                                48.0020917772913
                            ],
                            [
                                -1.4803189652127458,
                                48.0024471217911
                            ],
                            [
                                -1.4801419394177628,
                                48.00267324883469
                            ],
                            [
                                -1.4796913283032609,
                                48.00303935718458
                            ],
                            [
                                -1.4793050902051164,
                                48.003143446339095
                            ],
                            [
                                -1.478291215197487,
                                48.00328268334906
                            ],
                            [
                                -1.477567018763466,
                                48.00336882570624
                            ],
                            [
                                -1.4776957647961808,
                                48.00388208760238
                            ],
                            [
                                -1.4778204875153733,
                                48.0042033223445
                            ],
                            [
                                -1.4780672507447434,
                                48.00440970115126
                            ],
                            [
                                -1.4783837514085008,
                                48.00448507407483
                            ],
                            [
                                -1.4786973228567604,
                                48.004486762425
                            ],
                            [
                                -1.4786946406477455,
                                48.004542394748505
                            ],
                            [
                                -1.47858198786912,
                                48.0046500700429
                            ],
                            [
                                -1.4782743119187671,
                                48.004803458983965
                            ],
                            [
                                -1.477456238169225,
                                48.00501162996336
                            ],
                            [
                                -1.4776815437264759,
                                48.005614603231535
                            ],
                            [
                                -1.476043369211311,
                                48.00590438683001
                            ]
                        ]
                    },
                    "properties": {}
                }
            ]
        };

        // Json**************************************************************************************************>
        var geojsonPastCompetition = [{
            "type": "Feature",
            "properties": {
                "name": "Course 1",
                "description": "Du 1/10 au 4/10",
            },
            "geometry": {
                "type": "Point",
                "coordinates": [2.43896484375, 46.52863469527167]
            }
        }, {
            "type": "Feature",
            "properties": {
                "name": "Tout Rennes court",
                "description": "Du 1/10 au 4/10",
                "past": "false",
                "color": "ffffff",
            },
            "geometry": {
                "type": "Point",
                "coordinates": [3.43896484375, 47.52863469527167]
            }
        }];

        var geojsonFuturCompetition = [{
            "type": "Feature",
            "properties": {
                "name": "Course 1",
                "description": "Du 1/10 au 4/10",
                "past": "true"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [4.43896484375, 48.52863469527167]
            }
        }, {
            "type": "Feature",
            "properties": {
                "name": "Tout Rennes court",
                "description": "Du 1/10 au 4/10",
                "past": "false",
                "color": "ffffff",
            },
            "geometry": {
                "type": "Point",
                "coordinates": [5.43896484375, 49.52863469527167]
            }
        }];


        // map leaflet**************************************************************************************************>


        // map leaflet**************************************************************************************************>
        var osmLayer = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 18
        });

        var watercolorLayer = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 18
        });

        // map leaflet**************************************************************************************************>
        var pastIcon = L.icon({
            iconUrl: 'https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678111-map-marker-512.png',
            iconSize: [30, 30],
            iconAnchor: [0, 0],
            popupAnchor: [0, 0],

        });

        var futurIcon = L.icon({
            iconUrl: 'http://simpleicon.com/wp-content/uploads/map-marker-5.png',
            iconSize: [30, 30],
            iconAnchor: [0, 0],
            popupAnchor: [0, 0],

        });

        // map leaflet**************************************************************************************************>

        var PastCompetitionLayer = L.geoJSON(geojsonPastCompetition, {
            pointToLayer: function (geoJsonPoint, latlng) {
                return L.marker(latlng, {icon: pastIcon});
            }
        }).bindPopup(function (layer) {
            return layer.feature.properties.description;
        });

        var FuturCompetitionLayer = L.geoJSON(geojsonFuturCompetition, {
            pointToLayer: function (geoJsonPoint, latlng) {
                return L.marker(latlng, {icon: futurIcon});
            }
        }).bindPopup(function (layer) {
            return layer.feature.properties.description;
        });



        $.ajax({
            url: "{{ path('geoJson') }}",
            dataType: "json",
            success: function (data) {
                testLayer = L.geoJSON(data, {
                    pointToLayer: function (geoJsonPoint, latlng) {
                        return L.marker(latlng);
                    }
                }).bindPopup(function (layer) {
                    return layer.feature.properties.description;
                });

                mapConstructor(testLayer);



                console.log(data);
            }
        });

        // map constructor**************************************************************************************************>

        function mapConstructor(testLayer) {
            var map = L.map('indexMap', {
                center: [46.52863469527167, 2.43896484375],
                zoom: 5,
                layers: [osmLayer, PastCompetitionLayer, FuturCompetitionLayer, testLayer]
            });

            // Layers **************************************************************************************************>

            var baseMaps = {
                "osmLayer": osmLayer,
                "watercolorLayer": watercolorLayer
            };

            var overlayMaps = {
                "A venir": PastCompetitionLayer,
                "Passées": FuturCompetitionLayer,
                "testLayer": testLayer
            };

            L.control.layers(baseMaps, overlayMaps).addTo(map);
            L.geoJSON(trace).addTo(map);
        }

        // Line **************************************************************************************************>





    </script>

{% endblock %}

