{% extends 'form_layout.html.twig' %}

{% block title %}
    {{ parent() }} index
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretty-checkbox@3.0/dist/pretty-checkbox.min.css"/>
    <link rel="stylesheet" href="{{ asset('css/multi-switch.min.css') }}"/>
    <link rel="stylesheet" href="{{ asset('css/jquery.mCustomScrollbar.min.css') }}"/>



    <style>
        #search-bar {
            margin-top: 16em;
        }

        #index-map {
            height: 90%;
        }

        #small-map-container {
            height: 13em;
        }

        #small-map {
            height: 12em;
        }

        #index-map-container {
            height: 85vh;
            background-color: #ffffff;
           
        }

        .leaflet-popup-img {
            height: 3em;
        }

    </style>
{% endblock %}

{% block body %}
        <div id="index-container">
            <div class="col-md-3">

                <div id="small-map-container" class="col-xs-12">
                    <div class="col-xs-12" id="small-map"></div>
                    <button type="button" id="button-map" value="not-initialized" class="btn btn-info btn-sm col-xs-12">
                        Agrandir
                    </button>
                </div>

                {% include 'race/widget/searchBar.html.twig' %}


            </div>
            <div class="col-md-6">
                <div class="row">
                    {% for competition in competitions %}
                        {% include 'competition/modelList.twig' %}
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-3">
                <!--INFOS -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">A la une</div>
                    </div>
                    <ul class="list-group">
                        <li class="list-group-item info-content">
                            <div id="fade-container">
                                <div id="fade-content">
                                    <img src="{{ asset('img/01.jpg ') }}" class="pull-right info-img">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam accumsan risus vitae
                                        purus imperdiet tristique. Mauris lobortis orci mattis metus lobortis, ac
                                        tristique nunc sodales. Nullam sollicitudin rhoncus odio a placerat.
                                        Pellentesque consectetur venenatis nulla ut eleifend. Nunc et felis bibendum,
                                        feugiat neque nec, venenatis purus. Quisque vestibulum, mi a auctor sagittis, mi
                                        urna aliquet dui, ut commodo felis mi at urna. Vivamus a imperdiet enim, in
                                        semper dui. Maecenas iaculis condimentum justo, id pulvinar mi finibus a.
                                        Quisque blandit, arcu et pretium ullamcorper, massa nibh gravida enim, ac tempor
                                        odio turpis et dolor. Integer quis porttitor nisi. Mauris massa mauris, tempor
                                        sit amet enim hendrerit, tristique posuere mi. Vivamus mattis lacus efficitur
                                        consequat suscipit. Pellentesque lorem sem, condimentum non ante eu, dapibus
                                        elementum ipsum. Donec non sem sed risus molestie commodo.</p>
                                </div>
                                <div class="fade-anchor">
                                    <button type="button" class="btn btn-primary btn-xs">Lire la suite</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item info-content">
                            <div id="fade-container">
                                <div id="fade-content">
                                    <img src="{{ asset('img/02.jpg ') }}" class="pull-left info-img">
                                    <p>Donec a quam non leo dapibus lobortis. Nam ut facilisis diam, eu molestie nisi.
                                        Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
                                        himenaeos. In commodo nibh at dolor lobortis pulvinar. Vestibulum sollicitudin
                                        mattis metus, eget tincidunt mi pharetra a. Donec accumsan odio orci, id
                                        sagittis diam ornare et. Duis id condimentum ex, ac feugiat ligula. Pellentesque
                                        habitant morbi tristique senectus et netus et malesuada fames ac turpis
                                        egestas. </p>
                                </div>
                                <div class="fade-anchor">
                                    <button type="button" class="btn btn-primary btn-xs">Lire la suite</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item info-content">
                            <div id="fade-container">
                                <div id="fade-content">
                                    <img src="{{ asset('img/03.jpg ') }}" class="pull-left info-img">
                                    <p>Sed ultrices enim in mattis pulvinar. Mauris auctor elit eget augue facilisis, ut
                                        mattis lectus ultricies. Integer cursus orci ut nibh dapibus consequat. Proin
                                        eget purus ligula. Ut et eleifend nisl. Aenean scelerisque egestas sem in
                                        egestas. Mauris sed ipsum augue. Aenean erat ante, aliquet at felis vitae,
                                        convallis iaculis tellus. </p>
                                </div>
                                <div class="fade-anchor">
                                    <button type="button" class="btn btn-primary btn-xs">Lire la suite</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item info-content">
                            <div id="fade-container">
                                <div id="fade-content">
                                    <img src="{{ asset('img/04.jpg ') }}" class="pull-right info-img">
                                    <p>Donec imperdiet erat ut lacus blandit dapibus. Donec et consequat justo, ac
                                        blandit nisi. Nullam elementum luctus dapibus. Pellentesque ac porttitor lacus.
                                        Morbi varius non tortor in posuere. Suspendisse tincidunt in quam ut mattis.
                                        Mauris nec lobortis magna, a aliquam nulla. In auctor, ante eget consectetur
                                        gravida, purus urna condimentum sapien, at vehicula enim risus sit amet leo. Sed
                                        quis molestie purus. Integer bibendum et turpis sit amet euismod. Morbi sit amet
                                        orci congue sem scelerisque pulvinar. </p>
                                </div>
                                <div class="fade-anchor">
                                    <button type="button" class="btn btn-primary btn-xs">Lire la suite</button>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="index-map-container" class="col-xs-offset-1 col-xs-10">
            <div class="col-xs-12" id="index-map"></div>
            <br>
            <button type="button" id="button-map-close" class="btn btn-info btn-sm pull-right">Fermer</button>
        </div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}

    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script>
    <script src="{{ asset('js/jquery.mCustomScrollbar.concat.min.js') }}"></script>


    <script>
        //init
        indexMaps();
        searchBarRace();
        panelCategoriesScroll();

        function indexMaps() {
            var $indexContainer = $('#index-container');
            var $smallMap = $('#small-map');
            var $smallMapContainer = $('#small-map-container');
            var $indexMap = $('#index-map');
            var $indexMapConatiner = $('#index-map-container');
            var $indexButton = $('#button-map');
            var dataMap;

            $(function () {

                //loaderDivStart($smallMap);
                $indexMapConatiner.hide();

                //data map
                var path = Routing.generate('competition_get_geojson');
                $.ajax({
                    url: path,
                    success: function (data) {
                        dataMap = data;
                        smallMapBuild(data);
                    },
                    error: function () {
                        ajaxError();
                    }
                });
            });

            // Event**************************************************************************************************>

            $indexButton.click(function () {
                $indexContainer.hide();
                $indexMapConatiner.show();
                if ($(this).val() === 'not-initialized') {
                    indexMapBuild(dataMap);
                    $(this).val('is-initialized');
                }
            });

            $('#button-map-close').click(function () {
                $indexMapConatiner.hide();
                $indexContainer.show();
            });

            // Maps build**************************************************************************************************>
            var pastIcon = L.icon({
                iconUrl: 'http://icons.iconarchive.com/icons/icons-land/vista-map-markers/256/Map-Marker-Marker-Outside-Pink-icon.png',
                iconSize: [30, 30],
                iconAnchor: [11, 31],
                popupAnchor: [5, -25],

            });
            var futureIcon = L.icon({
                iconUrl: 'http://www.iconarchive.com/download/i57834/icons-land/vista-map-markers/Map-Marker-Marker-Outside-Chartreuse.ico',
                iconSize: [30, 30],
                iconAnchor: [11, 31],
                popupAnchor: [5, -25],

            });

            function smallMapBuild(data) {
                var FuturCompetitionLayer = layerBuild(data.futureCompetitions, pastIcon);

                var osmLayer = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
                    maxZoom: 18
                });
                var smallMap = L.map('small-map', {
                    center: [46.52863469527167, 2.43896484375],
                    zoom: 4,
                    layers: [osmLayer, FuturCompetitionLayer]
                });

                //loaderDivStop($smallMap);
            }

            function indexMapBuild(data) {
                var watercolorLayer = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
                    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
                    maxZoom: 18
                });
                var FuturCompetitionLayer2 = layerBuild(data.futureCompetitions, pastIcon);
                var PastCompetitionLayer2 = layerBuild(data.pastCompetitions, futureIcon);

                var osmLayer2 = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
                    maxZoom: 18
                });
                var indexMap = L.map('index-map', {
                    center: [46.52863469527167, 2.43896484375],
                    zoom: 5,
                    layers: [osmLayer2, PastCompetitionLayer2, FuturCompetitionLayer2]
                });

                //Layers Control **************************************************************************************************>
                var baseMaps = {
                    "osmLayer": osmLayer2,
                    "watercolorLayer": watercolorLayer
                };
                var overlayMaps = {
                    "A venir": FuturCompetitionLayer2,
                    "Passées": PastCompetitionLayer2
                };

                L.control.layers(baseMaps, overlayMaps).addTo(indexMap);
            }

            function layerBuild(data, icon) {
                return L.geoJSON(data, {
                    pointToLayer: function (geoJsonPoint, latlng) {
                        return L.marker(latlng, {icon: icon});
                    }
                }).bindPopup(function (layer) {
                    return layer.feature.properties.description;
                });
            }
        }
    </script>

{% endblock %}

