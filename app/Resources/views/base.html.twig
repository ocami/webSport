<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>WS{% block title %}{% endblock %}</title>

    {% block stylesheets %}
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="{{ asset('css/jquery.dataTables.css') }}"/>
        <link rel="stylesheet" href="{{ asset('css/main.css') }}"/>
        <link rel="stylesheet" href="{{ asset('tools/tools.css') }}"/>
    {% endblock %}

</head>

<body>

{% include 'navbar/general.html.twig' %}

{% if is_granted('ROLE_COMPETITOR') %}
    {% include 'modal/profile_competitor.html.twig' %}
{% endif %}

{% if is_granted('ROLE_ORGANIZER') %}
    <div id="organizer_menu">
        {% block organizer_menu %}
        {% endblock %}
    </div>
{% endif %}

{% if is_granted('ROLE_ADMIN') %}
    <div id="admin_menu">
        {% block admin_menu %}
        {% endblock %}
    </div>
{% endif %}

{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label }}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}
<div class="container">

    {% block body %}
    {% endblock %}

</div>


{#<footer>
<hr>
    <p>The sky's the limit © {{ 'now'|date('Y') }} and beyond.</p>
</footer>#}
</div>

{% block javascripts %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="{{ asset('js/main.js') }}"></script>
    <script src="{{ asset('tools/tools.js') }}"></script>


    <script>
        $(document).ready(function () {

            var li = document.createElement("LI");

            $.getJSON("{{ asset('json/navbar_championship.json') }}", function (result) {
                $.each(result, function (key, championship) {
                    var a = document.createElement("A");
                    var textLI = document.createTextNode(championship.name);
                    a.href = championship.path;
                    a.appendChild(textLI);
                    li.appendChild(a);
                    $('.championdhips-menu').append(li);

                });

            });
        });


        {% if is_granted('ROLE_ADMIN') %}

        $.ajax({
            url: "{{ path('race_countNotSupervised') }}",
            dataType: "json",
            success: function (data) {
                badgeCountRace(data);
            }
        });

        function badgeCountRace(nb) {
            var badge = $('.badge');
            badge.text(nb);

            if(nb == 0){
                badge.attr({
                    "title" : "Pas de nouvelle course à valider",
                    "class" : "badge badge-success"
                });
            }else {
                badge.attr({
                    "title" : "Nouvelles courses à valider",
                    "class" : "badge badge-warning"
                });
            }
        }


        {% endif %}


    </script>
{% endblock %}

</body>
</html>
