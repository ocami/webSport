var windowsSize=$(window).width();function adminRaces(){var f=$('#admin-race-show');var g;var h;var i;var j=$('#cb-Championship');j.checkboxradio();var k=$('#admin-races-table').DataTable({"info":false,"language":{"search":"Rechercher:","lengthMenu":"Voir _MENU_ courses  par page","zeroRecords":"Aucune courses non traitées","paginate":{"first":"Premier","last":"Dernier","next":"Suivant","previous":"précédent"},},select:{style:'single',selector:'td:first-child'},columns:[{data:'checkbox'},{data:'id'},{data:'name'},{data:'organizer'},{data:'city'},{data:'date'},{data:'championship'}],columnDefs:[{targets:0,orderable:false,className:'select-checkbox',width:"5%"},{targets:1,visible:false},{targets:3,width:"5%"},{targets:6,width:"20%"},{targets:7,width:"3%"}]});if(k.data().count()){tableSelectRow(0);preRaceShow(0);f.show();loaderDivStart(f);loaderStop()}else{f.hide();loaderStop()}k.on('select',function(e,a,b,c){loaderDivStart(f);preRaceShow(c)});$('#prev').click(function(){loaderDivStart(f);tableSelectRow(h+1)});$('#next').click(function(){loaderDivStart(f);tableSelectRow(h-1)});$('#valid').click(function(){loaderDivStart(f);var a=0;if(j.prop('checked'))a=1;raceUpdate(g,1,a)});$('#refuse').click(function(){loaderDivStart(f);raceUpdate(g,0,0)});function preRaceShow(a){if(k.data().count()){i=k.rows(a).data().toArray()[0];g=i['id'];h=k.row(a).index();raceShow(g)}else{loaderDivStop(f);f.hide()}}function raceShow(b){var c=Routing.generate('race_json',{race:b});$.ajax({url:c,success:function(a){hydrate(a)},error:function(){ajaxError()}})}function hydrate(c){var d=c.race.dateTime.replace(/\-|\:/g,' ');var d=d.split(" ");var d=new Date(Date.UTC(d[0],d[1],d[2],d[3]-2,d[4],d[5]));$('#admin-race-name').text(c.race.name);$('#admin-race-competition-id').attr('href',c.race.organizerId);$('#admin-race-competition-organizer').text('Orga : '+c.race.organizerName);$('#admin-race-competition-name').text(c.race.competitionName);$('#admin-race-distance').text(c.race.distance+' Km');$('#admin-race-day').text(d.toLocaleDateString('fr-FR',{weekday:'long',year:'numeric',month:'long',day:'numeric'}));$('#admin-race-hour').text(('0'+d.getHours()).slice(-2)+' : '+('0'+d.getMinutes()).slice(-2));$('#admin-race-address').text(c.race.street);$('#admin-race-city').text(c.race.postCode+' '+c.race.city);var e=$('#admin-race-categories')e.empty();$.each(c.categories,function(a,b){e.append(" <div class='col-xs-3 col-lg-2'><button class='btn-xs btn-info col-xs-12' disabled>"+b.name+"</button> </div>")});if(c.race.requestInChampionship)j.prop('checked',true).checkboxradio('refresh');else j.prop('checked',false).checkboxradio('refresh');loaderDivStop(f)}function raceUpdate(b,c,d){var e=Routing.generate('race_admin_supervise',{race:b,valid:c,inChampionship:d});$.ajax({url:e,success:function(a){k.row(h).remove().draw();tableSelectRow(0);preRaceShow(0);updateNbRace()},error:function(){ajaxError()}})}function updateNbRace(){var b=Routing.generate('race_countNotSupervised');$.ajax({url:b,success:function(a){navbarBadgeAdmin()},error:function(){ajaxError()}})}function tableSelectRow(a){k.row(':eq('+a+')',{page:'all'}).select()}}function competitionShowList(){var a=$('#competition-list-button');var b=$('#competition-list-title');var c=$('#future-competition');var d=$('#passed-competition');panelCategoriesHeight();loaderStop();a.click(function(){$('#competition-list-title-passed').hide();if(a.val()=='future')competitionDisplayNoPassed();else competitionDisplayPassed()});function competitionDisplayPassed(){a.text("Compétitions à venir");b.text("Compétitions passées");a.val('future');c.css('display',"none");d.css('display',"block")}function competitionDisplayNoPassed(){a.text("Compétitions passées");b.text("Compétitions à venir");a.val('passed');c.css('display',"block");d.css('display',"none")}};var language={"search":"Rechercher:","lengthMenu":"Voir _MENU_ compétiteurs  par page","zeroRecords":"Aucune inscription","paginate":{"first":"Premier","last":"Dernier","next":"Suivant","previous":"précédent"}};function raceShow(i,j){var k=$('#categories-button').find('button');var l=$('#categories-list').find('button');var m=$('#show-race-tables').find('.table-container');var n=$('#table-race');var o=$('#table-race-container');var p=$('#table-category');var q=$('#table-category-container');var r;getData('all');k.click(function(){loaderDivStart(null,j);getData($(this).val());k.attr('class','btn-xs btn-info col-xs-12');$(this).attr('class','btn-xs btn-primary col-xs-12')});l.click(function(){loaderDivStart(null,j);getData($(this).val());$("#collapse-race-categories").collapse('hide')});function getData(b){m.css('visibility','hidden');var c=Routing.generate('race_Table',{idRace:i,category:b});$.ajax({url:c,success:function(a){displayRaceTable(a,b)},error:function(){ajaxError()}})}function displayRaceTable(f,g){var h={language:language,responsive:true,bInfo:false,destroy:true,data:[],columns:[],columnDefs:[]};m.removeClass();h.data=f.competitors;if(g==='all'){r=n.find('.table-row')switch(f.race_state){case 0:raceOpenOptions();break;case 1:raceClosedOptions();break;case 2:racePassedOptions();break}q.hide();o.show();n.dataTable(h)}else{r=p.find('.table-row');switch(f.race_state){case 0:raceCategoryOpenOptions();break;case 1:raceCategoryCloseOptions();break;case 2:raceCategoryPassedOptions();break}o.hide();q.show();p.dataTable(h)}$('html, body').animate({scrollTop:$('#loader').offset().top},750);loaderDivStop();m.css('visibility','visible');function raceOpenOptions(){h.columns=[{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},{data:'category'}];r.empty();r.append("<th>Nom</th>");r.append("<th>Prénom</th>");r.append("<th>Catégorie</th>");m.addClass('col-lg-offset-2 col-lg-8')}function raceClosedOptions(){h.columns=[{data:'number',className:"row-rank"},{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},{data:'category'},];h.columnDefs=[{targets:0,width:"1%"}];r.empty();r.append("<th>Dossard</th>");r.append("<th>Nom</th>");r.append("<th>Prénom</th>");r.append("<th>Catégorie</th>");m.addClass('col-lg-offset-2 col-lg-8')}function racePassedOptions(){h.columns=[{data:'rank',className:"row-rank"},{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},{data:'chronoString',className:"row-rank"},{data:'number',className:"row-rank"},{data:'category'},{data:'rankCategory',className:"row-rank"}];h.columnDefs=[{targets:0,width:"1%"},{targets:4,width:"5%"},{targets:6,width:"5%"}];r.empty();r.append("<th>Gen.</th>");r.append("<th>Nom</th>");r.append("<th>Prénom</th>");r.append("<th>Chrono</th>");r.append("<th>Doss.</th>");r.append("<th>Catégorie</th>");r.append("<th>Cls.</th>");if(f.inChampionship){h.columns.push({data:'points',className:"row-rank"});h.columnDefs.push({targets:7,width:"5%"});r.append("<th>Point</th>")}m.addClass('col-lg-offset-1 col-lg-10')}function raceCategoryOpenOptions(){h.columns=[{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},];r.empty();r.append("<th>Nom</th>");r.append("<th>Prénom</th>");m.addClass('col-lg-offset-3 col-lg-6')}function raceCategoryCloseOptions(){h.columns=[{data:'number',className:"row-rank"},{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},];h.columnDefs=[{targets:0,width:"1%"}];r.empty();r.append("<th>Dossard</th>");r.append("<th>Nom</th>");r.append("<th>Prénom</th>");m.addClass('col-lg-offset-3 col-lg-6')}function raceCategoryPassedOptions(){h.columns=[{data:'rankCategory',className:"row-rank"},{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},{data:'chronoString',className:"row-rank"},{data:'number',className:"row-rank"},{data:'rank',className:"row-rank"}];h.columnDefs=[{targets:0,width:"1%"},{targets:4,width:"5%"},{targets:5,width:"5%"}];r.empty();r.append("<th>Cls</th>");r.append("<th>Nom</th>");r.append("<th>Prénom</th>");r.append("<th>Chrono</th>");r.append("<th>Doss</th>");r.append("<th>Gen.</th>");if(f.inChampionship){h.columns.push({data:'points',className:"row-rank"});h.columnDefs.push({targets:5,width:"5%"});r.append("<th>Point</th>")}m.addClass('col-lg-offset-2 col-lg-8')}}}function championshipShow(h,i){var j=$('#categories-button').find('button');var k=$('#categories-list').find('button');var l=$('#table-championship-container');var m=$('#table-championship');getData(h);j.click(function(){loaderDivStart(null,i);getData($(this).val());j.attr('class','btn-xs btn-info col-xs-12');$(this).attr('class','btn-xs btn-primary col-xs-12')});k.click(function(){loaderDivStart(null,i);getData($(this).val());$("#collapse-race-categories").collapse('hide')});function getData(b){l.css('visibility','hidden');var c=Routing.generate('championship_json',{idCategory:b});$.ajax({url:c,success:function(a){tableConstructor(a)},error:function(){ajaxError()}})}function tableConstructor(f){var g={language:language,responsive:true,bInfo:false,destroy:true,data:f,columns:[{data:'rank',className:"row-rank"},{"data":"lastName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.lastName+"</span>")}},{"data":"firstName","fnCreatedCell":function(a,b,c,d,e){$(a).html("<span class='table-href' onclick='profilData("+c.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+c.firstName+"</span>")}},{data:'points',className:"row-rank"},],columnDefs:[{targets:0,width:"5%"},{targets:3,width:"5%"}]};m.dataTable(g);loaderDivStop();l.css('visibility','visible')}}function competitorShow(){var a={responsive:true,bInfo:false,lengthChange:false,searching:false,paging:false,order:[],columnDefs:[{targets:0,responsivePriority:1},{targets:1,responsivePriority:5},{targets:2,responsivePriority:6},{targets:3,width:"1%",responsivePriority:2},{targets:4,responsivePriority:4},{targets:5,width:"1%",responsivePriority:3},]};$(document).ready(function(){$('.cs-table-ranck').DataTable(a)})}function registration(){$(function(){var a=$("#gender-radio input");var b=$('#appbundle_competitor_gender');a.checkboxradio();a.click(function(){if(this.checked){b.val($(this).val());b.trigger('change')}})});var c=$('#appbundle_competitor_date');var d=$('#register-form-dp');d.datepicker({language:'fr',format:'dd-mm-yyyy',startView:2,startDate:new Date('1950-01-01'),endDate:new Date('2002-12-31'),autoclose:true,todayHighlight:true});d.on('changeDate',function(){var a=parseDateFrToUs(d.datepicker('getFormattedDate'));c.val(a);c.trigger('change')})}function raceDistance(){$('#distance-widget').change(function(){$('#appbundle_race_distance').val($('#distance-widget').val())})}function raceCategories(){var b=$('#cbCategories-all');var c=$('#category-once input');var d=$('#cb-championship');var e=$('#appbundle_race_categoriesString');var f=$('#appbundle_race_requestInChampionship');var g;$("#race-form-categories input").checkboxradio();if(e.val())categoriesUpdate();if($('#appbundle_race_requestInChampionship').prop('checked'))$('#cb-championship').prop('checked',true).checkboxradio('refresh');d.click(function(){if(this.checked)f.prop('checked',true);else f.prop('checked',false)});b.click(function(){if(this.checked)c.prop('checked',true).checkboxradio('refresh');else c.prop('checked',false).checkboxradio('refresh');categoriesChange()});c.click(function(){categoriesChange()});function categoriesUpdate(){var a=$.parseJSON(e.val());c.each(function(){if(a.includes($(this).val()))$(this).prop('checked',true).checkboxradio('refresh')});categoriesChange()}function categoriesChange(){var i=0;g=[];c.each(function(){i++;if(this.checked)g.push($(this).val())});if(g.length<i)b.prop('checked',false).checkboxradio('refresh');if(g.length===i)b.prop('checked',true).checkboxradio('refresh');if(g.length>0)e.val(JSON.stringify(g));else e.val('');e.trigger('change')}}function competitionFormDates(){var b=$('#appbundle_competition_dateStart');var c=$('#appbundle_competition_dateEnd');var d=$('#dpStart');var e=$('#dpEnd');$('.datepicker').datepicker({language:'fr',format:'dd-mm-yyyy',todayBtn:'linked',autoclose:true,});if(b.val().length!==0)d.datepicker('update',parseDateUsToFr(b.val()));if(c.val().length!==0)e.datepicker('update',parseDateUsToFr(c.val()));d.on('changeDate',function(){var a=parseDateFrToUs(d.datepicker('getFormattedDate'));b.val(a);b.trigger('change');e.datepicker('setStartDate',d.datepicker('getDate'))});e.on('changeDate',function(){var a=parseDateFrToUs(e.datepicker('getFormattedDate'));c.val(a);c.trigger('change');d.datepicker('setEndDate',e.datepicker('getDate'))})}function navbarCompetitorProfile(){var b=$('#table-href');b.click(function(){var a=$(this).attr("data");profilData(a)})}function profilData(d){var e=$('.cs-body');loaderDivStart(e);getData(d);$('.competitor-profile').click(function(){window.location.href=Routing.generate('competitor_show',{id:d})});function getData(b){var c=Routing.generate('json_competitor',{id:b});$.ajax({url:c,success:function(a){inputText(a)},error:function(){ajaxError()}})}function inputText(a){$('.firstName').text(a.competitor.firstName+' ');$('.lastName').text(a.competitor.lastName);$('.age').text(a.competitor.age+' ans');$('.category').text(a.competitor.category);if(!a.championship){$('.ic-races').hide();$('.no-rank').show()}else{$('.rank').text(a.championship.rank);$('.points').text(a.championship.points);$('.icNbRace').text(a.raceStat.icNbRace);$('.icDistance').text(a.raceStat.icDistance+' Km');$('.icSpeed').text(a.raceStat.icSpeed+' Km/h')}if(a.raceStat.ncNbRace==0){$('.nc-races').hide()}else{$('.ncNbRace').text(a.raceStat.ncNbRace);$('.ncDistance').text(a.raceStat.ncDistance+' Km');$('.ncSpeed').text(a.raceStat.ncSpeed+' Km/h')}loaderDivStop(e)}}function panelCategoriesHeight(){$('.location-container').each(function(){var a=$(this).height();var b=$(this).attr('value');$('#categories-'+b).css('height',a+'px')})}function userBar(){var a=$('#user-bar');$(window).scroll(function(){if($(this).scrollTop()>54){a.addClass('fixed')}else{a.removeClass('fixed')}})}function userBarCompetitor(){var e=$('#user-bar').find('.next-race');var f;getDateNextRaceDate();e.click(function(){window.location=Routing.generate('race_show',{id:f})});function getDateNextRaceDate(){var b=Routing.generate('competitor_next_race');$.ajax({url:b,success:function(a){if(a){f=a.id;setTxtDate(a.date_time)}},error:function(){ajaxError()}})}function setTxtDate(a){var b=a.split(/[\s \- :]+/);a=new Date(Date.UTC(b[0],b[1]-1,b[2],0,0,0));var c={weekday:'long',month:'long',day:'numeric'};var d='Votre prochaine course : '+a.toLocaleDateString('fr-FR',c)+' '+b[3]+'H'+b[4];e.text(d)}}function navbarBadgeAdmin(){if(windowsSize>800){var c=Routing.generate('race_countNotSupervised');$.ajax({url:c,dataType:"json",success:function(a){var b=$('#badge');b.text(a);if(a==0){b.attr({"title":"Pas de nouvelle course à valider","class":"badge badge-success"})}else{b.attr({"title":"Nouvelles courses à valider","class":"badge badge-warning"})}},error:function(){ajaxError()}})}}function showSearch(){var b=$('#search-bar');var c=$('#search-bar-xs');var d=$('#button-search-xs');var e=$('#button-search');searchBarWidth();$(window).resize(function(){searchBarWidth()});function searchBarWidth(){var a=$(window).width();if(a<=751){d.before(b);b.css('margin-top','0em');if(a>650)c.css('padding','0em 15em 0em 15em');if(a<650&&a>500)c.css('padding','0em 10em 0em 10em');if(a<500&&a>375)c.css('padding','0em 5em 0em 5em');if(a<375)c.css('padding','0em 0.5em 0em 0.5em')}else{e.after(b);b.css('margin-top','16em')}loaderStop()}}function searchBarRace(){var l=todayDate();var m={categories:null,dep:null,dist:{min:null,max:null},date:{min:l,max:null},inChampionship:null,enrol:null};var n=$('#data-search').val();var o;if(n)o=JSON.parse(n);else o=m;var p=$("#search-bar").find('.switch-content');var q=$('#category-container');var r=$('#region-container');var s=$('#distance-container');var t=$('#date-container');var u=$('#championship-container');var v=$('#competitor-container');var w=r.find('.cb-dep');var x=q.find('input');var y=s.find('input');var z=t.find('input');var A=u.find('input');var B=v.find('input');var C=t.find('#date-min');var D=t.find('#date-max');t.find('.datepicker').datepicker({language:'fr',format:'dd-mm-yyyy',todayBtn:'linked',autoclose:true,});searchUpdate();function searchUpdate(){if(o.categories){x.each(function(){var a=$(this).val();if($.inArray(a,o.categories)!==-1){$(this).prop('checked',true);refreshCategory()}})}if(o.dep){w.each(function(){var a=$(this).val();if($.inArray(a,o.dep)!==-1){$(this).prop('checked',true);refreshDepartement($(this).attr('region'))}})}if(o.dist.min||o.dist.max){if(o.dist.min)$('#distMin').val(o.dist.min);if(o.dist.max)$('#distMax').val(o.dist.max);switchActive($('#switch-distance'));refreshDistance('active')}else refreshDistance('disable');if(o.date.min||o.date.max){if(o.date.min)C.datepicker('update',parseDateUsToFr(o.date.min));if(o.date.max)D.datepicker('update',parseDateUsToFr(o.date.max));switchActive($('#switch-date'));refreshDate('active')}else refreshDate('disable');if(o.inChampionship){if(o.inChampionship==='1')$('#radio-championship-1').prop('checked',true);if(o.inChampionship==='0')$('#radio-championship-0').prop('checked',true);refreshChampionship('active')}else refreshChampionship('disable');if(o.enrol){if($.inArray('1',o.enrol)!==-1)$('#canEnrol').prop('checked',true);if($.inArray('2',o.enrol)!==-1)$('#isEnrol').prop('checked',true);if($.inArray('3',o.enrol)!==-1)$('#participated').prop('checked',true);refreshCompetitor()}else refreshCompetitor()}p.click(function(){var a=$(this);var b=a.attr('status');var c=a.attr('id').split('-');var d=a.attr('initial');if(d!=='0'){b=d;a.attr('initial','0')}switch(c[1]){case'region':refreshRegion(c[2],b);break;case'category':if(b==="active")x.prop('checked',true);else x.prop('checked',false);refreshCategory();break;case'distance':refreshDistance(b);break;case'date':refreshDate(b);break;case'championship':refreshChampionship(b);break;case'competitor':if(b==="active")B.prop('checked',true);else B.prop('checked',false);refreshCompetitor();break}switch(b){case'disable':switchDisable(a);break;case'active':switchActive(a);break;case'initial':break}});w.click(function(){refreshDepartement($(this).attr('region'))});x.click(function(){refreshCategory()});y.change(function(){refreshDistance('active')});z.change('changeDate',function(){refreshDate('active')});A.click(function(){m.inChampionship=$(this).val()});B.change(function(){refreshCompetitor()});$('#button-search, #button-search-xs').click(function(){var a=Routing.generate('races_search',{dataSearch:JSON.stringify(m)});window.location=a});function refreshRegion(a,b){var c;if(a!=='all')c=$("#region-"+a).find('.cb-dep');else c=$("#region-container").find('.cb-dep');if(b==="active")c.prop('checked',true);else c.prop('checked',false);refreshDepartement(a)}function refreshDepartement(c){var d=0;var e=0;var f=0;var g=0;var h=[];var i=$("#switch-region-"+c);var j=$("#switch-region-all");var k=$('#region-container').find('.switch-content');w.each(function(){var a=$(this).val();var b=$(this).attr('region');f++;if(b===c)d++;if(this.checked){h.push(a);g++;if(b===c)e++}});if(e===0)switchDisable(i);else if(e===d)switchActive(i);else switchInitial(i);if(g===0){k.each(function(){switchDisable($(this))})}else if(g===f){k.each(function(){switchActive($(this))})}else switchInitial(j);if(g===0||g===f)m.dep=null;else m.dep=h}function refreshCategory(){var b=0;var c=0;var d=$("#switch-category");var e=[];x.each(function(){var a=$(this).val();b++;if(this.checked){e.push(a);c++}});if(c===0){switchDisable(d)}else if(c===b)switchActive(d);else switchInitial(d);if(c===0||c===b)m.categories=null;else m.categories=e}function refreshDistance(a){var b=$('#distance-container');if(a==="active"){var c=$('#distMin');var d=$('#distMax');var e=c.val();var f=d.val();b.css({'opacity':1,'pointer-events':'auto'});m.dist.min=e;m.dist.max=f;c.attr('max',f);d.attr('min',e)}else{b.css({'opacity':0.5,'pointer-events':'none'});m.dist.min=null;m.dist.max=null}}function refreshDate(a){if(a==="active"){t.css({'opacity':1,'pointer-events':'auto'});if(C.val()){m.date.min=parseDateFrToUs(C.datepicker('getFormattedDate'));C.datepicker('setEndDate',D.datepicker('getDate'))}else m.date.min=null;if(D.val()){m.date.max=parseDateFrToUs(D.datepicker('getFormattedDate'));D.datepicker('setStartDate',C.datepicker('getDate'))}else m.date.max=null}else{t.css({'opacity':0.5,'pointer-events':'none'});m.date.min=null;m.date.max=null}}function refreshChampionship(a){if(a==="active"){u.css({'opacity':1,'pointer-events':'auto'});switchActive($('#switch-championship'));if($('#radio-championship-1').is(':checked'))m.inChampionship='1';if($('#radio-championship-0').is(':checked'))m.inChampionship='0'}else{u.css({'opacity':0.5,'pointer-events':'none'});m.inChampionship=null}}function refreshCompetitor(){var a=0;var b=0;var c=$("#switch-competitor");var d=[];B.each(function(){a++;if(this.checked){d.push($(this).val());b++}});if(b===0){switchDisable(c);m.enrol=null}else{if(b===a)switchActive(c);else switchInitial(c);m.enrol=d}}function switchDisable(a){a.find('.info-slide').remove();a.attr({'class':'switch-content disable','status':'active','initial':'0'})}function switchActive(a){a.find('.info-slide').remove();a.attr({'class':'switch-content active','status':'disable','initial':'0'})}function switchInitial(a){a.attr({'status':'initial','class':'switch-content initial','initial':true});var b=$('<span class="info-slide disable" title="tout supprimer"/>');var c=$('<span class="info-slide active" title="tout sélectionner"/>');a.append(b);a.append(c);b.hover(function(){a.addClass('disable');a.removeClass('initial')},function(){a.addClass('initial');a.removeClass('disable')});c.hover(function(){a.addClass('active');a.removeClass('initial')},function(){a.addClass('initial');a.removeClass('active')});c.click(function(){a.find('.info-slide').remove();a.attr('initial','active')});b.click(function(){a.find('.info-slide').remove();a.attr('initial','disable')})}}function competitorSearchRace(a){var b=todayDate();var c;if(a==='future')c={min:b,max:null};else c={min:null,max:b};var d={categories:null,dep:null,dist:{min:null,max:null},date:c,inChampionship:null,enrol:['2','3']};var e=Routing.generate('races_search',{dataSearch:JSON.stringify(d)});window.location=e}function searchRaceAll(){var a=todayDate();var b={categories:null,dep:null,dist:{min:null,max:null},date:{min:a,max:null},inChampionship:null,enrol:null};var c=Routing.generate('races_search',{dataSearch:JSON.stringify(b)});window.location=c}function searchLayout(){searchBarRace();if($(window).width()<=751){$('#index-container').css('margin-left','0em')}panelCategoriesHeight();loaderStop();var i=$('#index-content');var j=$('#small-map');var k=$('#small-map-container');var l=$('#index-map');var m=$('#index-map-container');var n=$('#button-map');var o;var p=L.icon({iconUrl:'/webSport/web/img/green.ico',iconSize:[30,30],iconAnchor:[11,31],popupAnchor:[5,-25]});var q=L.icon({iconUrl:'/webSport/web/img/pink.png',iconSize:[30,30],iconAnchor:[11,31],popupAnchor:[5,-25]});m.hide();initialiseMap();n.click(function(){i.hide();m.show();if($(this).val()==='not-initialized'){indexMapBuild(o);$(this).val('is-initialized')}});$('#button-map-close').click(function(){m.hide();i.show()});$(window).resize(function(){if($(window).width()<=751){$('#index-container').css('margin-left','0em')}else{$('#index-container').css('margin-left','17em')}});function initialiseMap(){var b=Routing.generate('competition_get_geojson');$.ajax({url:b,success:function(a){o=a;smallMapBuild(a)},error:function(){ajaxError()}})}function smallMapBuild(a){var b=layerBuild(a.futureCompetitions,p);var c=L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18});var d=L.map('small-map',{center:[46.52863469527167,0],zoom:4,layers:[c,b]});n.css('visibility','visible')}function indexMapBuild(a){var b=L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg',{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18});var c=layerBuild(a.futureCompetitions,p);var d=layerBuild(a.pastCompetitions,q);var e=L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18});var f=L.map('index-map',{center:[46.52863469527167,2.43896484375],zoom:5,layers:[e,d,c]});var g={"osmLayer":e,"watercolorLayer":b};var h={"A venir":c,"Passées":d};L.control.layers(g,h).addTo(f)}function layerBuild(c,d){return L.geoJSON(c,{pointToLayer:function(a,b){return L.marker(b,{icon:d})}}).bindPopup(function(a){return a.feature.properties.description})}}function loaderStop(){$('#full-page').fadeOut(1000)}function loaderDivStart(a,b){var c=$("#loader-div");if(a){c.height(a.height());c.width(a.width());a.hide()}else{c.height(b);c.width('100%')}c.show()}function loaderDivStop(a){var b=$("#loader-div");b.hide();if(a)a.show()}function todayDate(){var a=new Date();var b=a.getDate();var c=a.getMonth()+1;var d=a.getFullYear();if(b<10){b='0'+b}if(c<10){c='0'+c}a=d+'-'+c+'-'+b;return a}function parseDateFrToUs(a){var d=new Date(a.split("-").reverse().join("-"));var b=('0'+d.getDate()).slice(-2);var c=d.getMonth()+1;var c=('0'+c).slice(-2);var e=d.getFullYear();var f=e+"-"+c+"-"+b;return f}function parseDateUsToFr(a){var d=new Date(a);var b=('0'+d.getDate()).slice(-2);var c=d.getMonth()+1;var c=('0'+c).slice(-2);var e=d.getFullYear();var f=b+"-"+c+"-"+e;return f}function stringDate(a){var b=a.split(/[\s \- :]+/);a=new Date(Date.UTC(b[0],b[1]-1,b[2],0,0,0));var c={weekday:'long',month:'long',day:'numeric'};return a.toLocaleDateString('fr-FR',c)}function ajaxError(){$('#info').css('display','block');$('#info span').text('Erreur requête ajax');loaderStop();$('#info-button').click(function(){location.reload();$('#info').css('display','none')})}(function($){var g;var h=$("<div class='col-xs-offset-1 col-xs-6'>");var i=$("<div id='location_alert' class='alert alert-warning' role='alert' style='display: none'></div>");var j=$("<div class='loader-div'></div>");var k=$("<div id='location_form' class='form-group'>");var l=$("<label id='location_label'>Département</label>");var m=$("<input id='location_input' class='form-control' placeholder='Ex : 06 Alpes-Maritimes'>");var n=$("<button id='next_step_btn' class='col-xs-2  btn btn-primary btn-sm' value='depValidate'>Suivant</button>");var o=$("<div id='location-show' class='col-xs-5'></div>");$.fn.locationForm=function(a){var b={"update":false};var c=$.extend(b,a);g=c.output;k.append([l,m]);h.append([i,j,k,n,o]);this.append([h,o]);if(g.val().length!==0){locationUpdate($.parseJSON(g.val()));return this}depAutocomplete();return this};var p;var q;var r;var s;var t=false;var u;m.on('keyup',function(e){if(e.keyCode===13){n.trigger('click')}});function nextStep(a){switch(a){case'dep':depAutocomplete();l.text('Département');m.attr("placeholder","Ex : 06 Alpes-Maritimes");n.val('depValidate');loaderDivStop(k);break;case'depValidate':loaderDivStart(k);depValidate();break;case'city':cityAutocomplete(p);l.text('Ville');m.attr("placeholder","Ex : nice");n.val('cityValidate');break;case'cityValidate':loaderDivStart(k);cityValidate();break;case'address':addressAutocomplete(r);l.text('Adresse');m.attr("placeholder","Ex : 5 Promenade des Anglais");n.val('addressValidate');loaderDivStop(k);break;case'addressValidate':addressValidate();break;case'confirm':k.hide();n.hide();locationConfirm();break}m.focus()}function returnStep(a){m.val('');k.show();n.show();t=false;switch(a){case'dep':$('#show_dep').remove();p='';case'city':$('#show_city').remove();r='';case'address':$('#show_address').remove();s='';if(typeof u!=='undefined')u.remove()}nextStep(a);g.val('');g.trigger('change')}function depAutocomplete(){$.get('/webSport/web/json/departements.json',function(c,d){m.autocomplete({source:c,messages:{noResults:'',results:function(){}},focus:function(a,b){$(".ui-helper-hidden-accessible").hide()}})})}function depValidate(){q=m.val();p=q.slice(0,2);i.hide();$.get("/webSport/web/json/departements.json",function(a,b){if($.inArray(m.val(),a)!==-1){addShowElement(m.val(),'dep');m.val('');nextStep('city')}else{nextStep('dep');i.text('Veuillez sélectionner un département dans la liste');i.show()}})}function cityAutocomplete(e){var f=Routing.generate('address_getCitiesSlugByDep',{dep:e});$.ajax({url:f,success:function(c){var d=[];$.map(c,function(a){d.push(a.villeSlug)});m.autocomplete({source:d,messages:{noResults:'',results:function(){}},focus:function(a,b){$(".ui-helper-hidden-accessible").hide()}});loaderDivStop(k);m.focus()}})}function cityValidate(){var c=m.val();m.val('');i.hide();$.ajax({url:Routing.generate('address_getCitiesData',{ville_slug:c}),dataType:"json",success:function(a){var b=a[0];if(a.length>0&&c==b.villeSlug){addShowElement(b.villeNomReel,'city');r=b.villeCodeCommune;nextStep('address')}else{nextStep('city');i.text('Veuillez sélectionner une commune dans la liste');i.show()}}})}function addressAutocomplete(f){m.autocomplete({source:function(d,e){$.ajax({url:"https://api-adresse.data.gouv.fr/search/?citycode="+f,data:{q:d.term},dataType:"json",success:function(c){e($.map(c.features,function(a){var b={label:a.properties.name,value:a.properties.name};return b}));autocompleteAddressList=c.features}})},messages:{noResults:'',results:function(){}},focus:function(a,b){$(".ui-helper-hidden-accessible").hide()}})}function addressValidate(){$.ajax({url:"https://api-adresse.data.gouv.fr/search/?citycode="+r,data:{q:m.val()},dataType:"json",success:function(a){if(a.features.length>0&&a.features[0].properties.name==m.val()){var b=a.features[0];addShowElement(b.properties.name,'address');setLocationData(b);i.hide();nextStep('confirm')}else{i.text('Veuillez sélectionner une adresse dans la liste');i.show();nextStep('address')}},error:function(){ajaxError()}})}function locationConfirm(){u=$("<div>",{id:"location-map"});k.after(u);openLocationMap(s.x,s.y,'location-map');t=true;g.val(JSON.stringify(s));g.trigger('change')}o.on('click','button',function(a){returnStep($(this).val())});n.click(function(){nextStep($(this).val())});function addShowElement(a,b){var c=$("<div>",{id:"show_"+b,class:"form_show row "});var d=$("<p>",{class:"col-xs-7"}).append(a);var e=$("<button>",{class:"col-xs-2 edit_bt btn btn-success btn-xs",value:b}).append('modifier');c.append(d);c.append(e);o.append(c)}function setLocationData(a){var f=a;s={id:f.properties.id,street:f.properties.name,depCode:p,dep:q,postCode:f.properties.postcode,cityCode:r,city:f.properties.city,x:f.geometry.coordinates[1],y:f.geometry.coordinates[0]}}function locationUpdate(a){n.hide();k.hide();p=a.depCode;r=a.cityCode;addShowElement(a.dep,'dep');addShowElement(a.city,'city');addShowElement(a.street,'address');u=$("<div>",{id:"location-map"});k.after(u);openLocationMap(a.x,a.y,'location-map');t=true}function openLocationMap(x,y,a){var b=L.map(a,{center:[x,y],zoom:18,});L.marker([x,y]).addTo(b);L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}).addTo(b)}}(jQuery));(function($){var j=$("<div id='ocm-dt-date-show'></div>");var k=$("<input id='ocm-dt-hour' type='number' min='0' max='23' maxlength='2' required>");var l=$("<input id='ocm-dt-minute' type='number' min='0' max='59' maxlength='2' required>");var m=$("<div id='ocm-dt-datepicker'></div>");var n;var o;$.fn.ocmDateTime=function(a){var b={"defaultHour":12,"defaultMinute":30};o=$.extend(b,a);n=o.output;var c=$("<div class='n2 col-xs-5'></div>").append(k);var d=$("<div class='n2 col-xs-offset-1 col-xs-1 '><span class='separator'>:</span></div>");var e=$("<div class='n2 col-xs-5'></div>").append(l);var f=$("<div class='calendar-show '></div>").append(m);var g=$("<div class=' col-xs-12 col-sm-offset-0 col-sm-4 calendar'>").append(f);var h=$("<div id='ocm-dt-time' class='time-input col-xs-10'></div>").append([c,"<div class='n2 col-xs-1'></div>",d,e]);var i=$("<div class='col-xs-12 col-sm-8'>").append([j,"<div class='col-xs-1'></div>",h]);this.append([i,g]);m.datepicker({format:"yyyy-mm-dd",startDate:o.dateStart,endDate:o.dateEnd,language:"fr"});m.datepicker('update',o.defaultDate);k.val(('0'+o.defaultHour).slice(-2));l.val(('0'+o.defaultMinute).slice(-2));dateString();changeDateTime();return this};m.on('changeDate',function(){dateString();changeDateTime()});k.add(l).change(function(){$(this).val(('0'+$(this).val()).slice(-2));changeDateTime()});function dateString(){j.text(m.datepicker('getUTCDate').toLocaleDateString('fr-FR',{weekday:'long',year:'numeric',month:'long',day:'numeric'}))}function changeDateTime(){var a=k.val();var b=l.val();if($.isNumeric(a)&&$.isNumeric(b)){if(a>23||a<0)k.val(o.defaultHour);if(b>59||b<0)l.val(o.defaultMinute);n.val(m.datepicker('getFormattedDate')+' '+k.val()+':'+l.val()+':00')}else{k.val(o.defaultHour);l.val(o.defaultMinute)}n.trigger('change')}}(jQuery));