function navbarBadgeAdmin(){var e=Routing.generate("race_countNotSupervised");$.ajax({url:e,dataType:"json",success:function(e){var a=$("#badge");a.text(e),0==e?a.attr({title:"Pas de nouvelle course à valider","class":"badge badge-success"}):a.attr({title:"Nouvelles courses à valider","class":"badge badge-warning"})},error:function(){ajaxError()}})}function homeIndex(){function e(e){var r=a(e.futureCompetitions,n),c=a(e.pastCompetitions,o),s=L.map("indexMap",{center:[46.52863469527167,2.43896484375],zoom:5,layers:[t,c,r]}),l={osmLayer:t,watercolorLayer:i},d={"A venir":r,"Passées":c};L.control.layers(l,d).addTo(s),loaderStop()}function a(e,a){return L.geoJSON(e,{pointToLayer:function(e,t){return L.marker(t,{icon:a})}}).bindPopup(function(e){return e.feature.properties.description})}loaderStart();var t=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}),i=L.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}),n=L.icon({iconUrl:"http://icons.iconarchive.com/icons/icons-land/vista-map-markers/256/Map-Marker-Marker-Outside-Pink-icon.png",iconSize:[30,30],iconAnchor:[11,31],popupAnchor:[5,-25]}),o=L.icon({iconUrl:"http://www.iconarchive.com/download/i57834/icons-land/vista-map-markers/Map-Marker-Marker-Outside-Chartreuse.ico",iconSize:[30,30],iconAnchor:[11,31],popupAnchor:[5,-25]}),r=Routing.generate("competition_get_geojson");$.ajax({url:r,success:function(a){e(a)},error:function(){ajaxError()}})}function navbarCompetitorProfile(){var e=$("#table-href");e.click(function(){var e=$(this).attr("data");profilData(e)})}function profilData(e){var a=Routing.generate("competitor_json_userId",{userId:e});$.ajax({url:a,success:function(e){$("#profile-name").text(e.firstName+" "+e.lastName),$("#profile-category").text(e.category),$("#profile-age").text(e.age+" ans")},error:function(){ajaxError()}})}function championshipShow(e){function a(e){loaderDivStart(n);var a=Routing.generate("championship_json",{idCategory:e});$.ajax({url:a,success:function(a){t(a,e)},error:function(){ajaxError()}})}function t(e){o.data=e,$("#table-championship").DataTable(o),loaderDivStop(n),loaderStop()}var i=$("#championship-show-categories").find("button"),n=$("#table"),o={destroy:!0,language:language,bInfo:!1,order:[[0,"asc"]]};o.columns=[{data:"rank",className:"row-rank"},{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}},{data:"points",className:"row-rank"}],o.columnDefs=[{targets:0,width:"5%"},{targets:3,width:"5%"}],a(e),i.click(function(){a($(this).val()),i.attr("class","btn-xs btn-info col-xs-12"),$(this).attr("class","btn-xs btn-primary col-xs-12")}),$(".table-href").click(function(){var e=$(this).attr("data");profilData(e)})}function adminRaces(){function e(e){p.data().count()?(s=p.rows(e).data().toArray()[0],r=s.id,c=p.row(e).index(),a(r)):(loaderDivStop(l),l.hide())}function a(e){var a=Routing.generate("race_json",{race:e});$.ajax({url:a,success:function(e){t(e)},error:function(){ajaxError()}})}function t(e){var a=e.race.dateTime.replace(/\-|\:/g," "),a=a.split(" "),a=new Date(Date.UTC(a[0],a[1],a[2],a[3]-2,a[4],a[5]));$("#admin-race-name").text(e.race.name),$("#admin-race-competition-id").attr("href",e.race.organizerId),$("#admin-race-competition-organizer").text("Orga : "+e.race.organizerName),$("#admin-race-competition-name").text(e.race.competitionName),$("#admin-race-distance").text(e.race.distance+" Km"),$("#admin-race-day").text(a.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),$("#admin-race-hour").text(("0"+a.getHours()).slice(-2)+" : "+("0"+a.getMinutes()).slice(-2)),$("#admin-race-address").text(e.race.street),$("#admin-race-city").text(e.race.postCode+" "+e.race.city);var t=$("#admin-race-categories");t.empty(),$.each(e.categories,function(e,a){t.append(" <div class='col-xs-3 col-lg-2'><button class='btn-xs btn-info col-xs-12' disabled>"+a.name+"</button> </div>")}),e.race.requestInChampionship?d.prop("checked",!0).checkboxradio("refresh"):d.prop("checked",!1).checkboxradio("refresh"),loaderDivStop(l)}function i(a,t,i){var r=Routing.generate("race_admin_supervise",{race:a,valid:t,inChampionship:i});$.ajax({url:r,success:function(){p.row(c).remove().draw(),o(0),e(0),n()},error:function(){ajaxError()}})}function n(){var e=Routing.generate("race_countNotSupervised");$.ajax({url:e,success:function(){navbarBadgeAdmin()},error:function(){ajaxError()}})}function o(e){p.row(":eq("+e+")",{page:"all"}).select()}var r,c,s,l=$("#admin-race-show"),d=$("#cb-Championship");d.checkboxradio();var p=$("#admin-races-table").DataTable({info:!1,language:{search:"Rechercher:",lengthMenu:"Voir _MENU_ courses  par page",zeroRecords:"Aucune courses non traitées",paginate:{first:"Premier",last:"Dernier",next:"Suivant",previous:"précédent"}},select:{style:"single",selector:"td:first-child"},columns:[{data:"checkbox"},{data:"id"},{data:"name"},{data:"organizer"},{data:"city"},{data:"date"},{data:"championship"}],columnDefs:[{targets:0,orderable:!1,className:"select-checkbox",width:"5%"},{targets:1,visible:!1},{targets:3,width:"5%"},{targets:6,width:"20%"},{targets:7,width:"3%"}]});p.data().count()?(o(0),e(0),l.show(),loaderDivStart(l),loaderStop()):(l.hide(),loaderStop()),p.on("select",function(a,t,i,n){loaderDivStart(l),e(n)}),$("#prev").click(function(){loaderDivStart(l),o(c+1)}),$("#next").click(function(){loaderDivStart(l),o(c-1)}),d.click(function(){this.checked?cbChampionship(!0):cbChampionship(!1)}),$("#valid").click(function(){loaderDivStart(l);var e=0;d.prop("checked")&&(e=1),i(r,1,e)}),$("#refuse").click(function(){loaderDivStart(l),i(r,0,0)})}function competitionShowList(){function e(){t.text("Compétition à venir"),t.val("future"),i.css("display","none"),n.css("display","block")}function a(){t.text("Compétition passées"),t.val("passed"),i.css("display","block"),n.css("display","none")}var t=$("#competitionDisplayButton"),i=$("#competitionsNoPassed"),n=$("#competitionsPassed");t.click(function(){"future"==t.val()?a():e()})}function competitionFormDates(){var e=$("#appbundle_competition_dateStart"),a=$("#appbundle_competition_dateEnd"),t=$("#dpStart"),i=$("#dpEnd");$(".datepicker").datepicker({language:"fr",format:"dd-mm-yyyy",todayBtn:"linked",autoclose:!0}),0!==e.val().length&&t.datepicker("update",parseDateUsToFr(e.val())),0!==a.val().length&&i.datepicker("update",parseDateUsToFr(a.val())),t.on("changeDate",function(){var a=parseDateFrToUs(t.datepicker("getFormattedDate"));e.val(a),e.trigger("change"),i.datepicker("setStartDate",t.datepicker("getDate"))}),i.on("changeDate",function(){var e=parseDateFrToUs(i.datepicker("getFormattedDate"));a.val(e),a.trigger("change"),t.datepicker("setEndDate",i.datepicker("getDate"))})}function raceDistance(){$("#distance-widget").change(function(){$("#appbundle_race_distance").val($("#distance-widget").val())})}function raceCategories(){function e(){var e=0;a=[],i.each(function(){e++,this.checked&&a.push($(this).val())}),a.length<e&&t.prop("checked",!1).checkboxradio("refresh"),a.length>0?o.val(JSON.stringify(a)):o.val(""),o.trigger("change")}var a,t=$("#cbCategories-all"),i=$("#category-once input"),n=$("#cb-championship"),o=$("#appbundle_race_categoriesString"),r=$("#appbundle_race_requestInChampionship");$(function(){$("#race-form-categories input").checkboxradio()}),n.click(function(){this.checked?r.prop("checked",!0):r.prop("checked",!1)}),t.click(function(){this.checked?i.prop("checked",!0).checkboxradio("refresh"):i.prop("checked",!1).checkboxradio("refresh"),e()}),i.click(function(){e()})}function raceShow(e,a){function t(a){loaderDivStart(c);var t=Routing.generate("race_Table",{idRace:e,category:a});$.ajax({url:t,success:function(e){i(e,a)},error:function(){ajaxError()}})}function i(e,t){function i(){u.columns=[{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}},{data:"category"}],n.empty(),n.append("<th>Nom</th>"),n.append("<th>Prénom</th>"),n.append("<th>Catégorie</th>"),c.addClass("col-lg-offset-3 col-lg-6")}function r(){u.columns=[{data:"number",className:"row-rank"},{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}},{data:"category"}],u.columnDefs=[{targets:0,width:"5%"}],n.empty(),n.append("<th>Dossard</th>"),n.append("<th>Nom</th>"),n.append("<th>Prénom</th>"),n.append("<th>Catégorie</th>"),c.addClass("col-lg-offset-2 col-lg-8")}function s(){u.columns=[{data:"rank",className:"row-rank"},{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}},{data:"number",className:"row-rank"},{data:"chronoString",className:"row-rank"},{data:"category"},{data:"rankCategory",className:"row-rank"}],u.columnDefs=[{targets:0,width:"5%"},{targets:3,width:"5%"},{targets:6,width:"5%"}],n.empty(),n.append("<th>Gen.</th>"),n.append("<th>Nom</th>"),n.append("<th>Prénom</th>"),n.append("<th>Doss.</th>"),n.append("<th>Chrono</th>"),n.append("<th>Catégorie</th>"),n.append("<th>Cls.</th>"),a&&(u.columns.push({data:"points",className:"row-rank"}),u.columnDefs.push({targets:7,width:"5%"}),n.append("<th>Point</th>")),c.addClass("col-lg-offset-1 col-lg-10")}function l(){u.columns=[{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}}],n.empty(),n.append("<th>Nom</th>"),n.append("<th>Prénom</th>"),c.addClass("col-lg-offset-3 col-lg-6")}function d(){u.columns=[{data:"number",className:"row-rank"},{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}}],u.columnDefs=[{targets:0,width:"5%"}],n.empty(),n.append("<th>Dossard</th>"),n.append("<th>Nom</th>"),n.append("<th>Prénom</th>"),c.addClass("col-lg-offset-3 col-lg-6")}function p(){u.columns=[{data:"rankCategory",className:"row-rank"},{data:"lastName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.lastName+"</span>")}},{data:"firstName",fnCreatedCell:function(e,a,t){$(e).html("<span class='table-href' onclick='profilData("+t.id+" )' data-toggle='modal' data-target='#competitor-modal'>"+t.firstName+"</span>")}},{data:"number",className:"row-rank"},{data:"chronoString",className:"row-rank"},{data:"rank",className:"row-rank"}],u.columnDefs=[{targets:0,width:"5%"},{targets:3,width:"5%"},{targets:5,width:"5%"}],n.empty(),n.append("<th>Cls</th>"),n.append("<th>Nom</th>"),n.append("<th>Prénom</th>"),n.append("<th>Doss</th>"),n.append("<th>Chrono</th>"),n.append("<th>Gen.</th>"),a&&(u.columns.push({data:"points",className:"row-rank"}),u.columnDefs.push({targets:5,width:"5%"}),n.append("<th>Point</th>")),c.addClass("col-lg-offset-2 col-lg-8")}var u={data:e.competitors,destroy:!0,language:language,bInfo:!1,order:[[0,"asc"]]};if("all"===t){switch(n=$("#row-table-race"),e.race_state){case 0:i();break;case 1:r();break;case 2:s()}$("#table-race-category-container").hide(),$("#table-race-container").show(),$("#table-race").dataTable(u)}else{switch(n=$("#row-table-race-category"),e.race_state){case 0:l();break;case 1:d();break;case 2:p()}$("#table-race-container").hide(),$("#table-race-category-container").show(),$("#table-race-category").dataTable(u)}loaderDivStop(c),$("html, body").animate({scrollTop:$(o).offset().top},750)}var n,o=$("#race-show-categories"),r=$("#race-show-categories button"),c=$("#tables");$(document).ready(function(){t("all")}),r.click(function(){c.removeClass(),t($(this).val()),r.attr("class","btn-xs btn-info col-xs-12"),$(this).attr("class","btn-xs btn-primary col-xs-12")}),$(".table-href").click(function(){var e=$(this).attr("data");profilData(e)})}function searchBarRace(){function e(){p.categories&&w.each(function(){var e=$(this).val();-1!==$.inArray(e,p.categories)&&($(this).prop("checked",!0),i())}),p.dep&&x.each(function(){var e=$(this).val();-1!==$.inArray(e,p.dep)&&($(this).prop("checked",!0),t($(this).attr("region")))}),p.dist.min||p.dist.max?(p.dist.min&&$("#distMin").val(p.dist.min),p.dist.max&&$("#distMax").val(p.dist.max),l($("#switch-distance")),n("active")):n("disable"),p.date.min||p.date.max?(p.date.min&&_.datepicker("update",parseDateUsToFr(p.date.min)),p.date.max&&j.datepicker("update",parseDateUsToFr(p.date.max)),l($("#switch-date")),o("active")):o("disable"),p.inChampionship?("1"===p.inChampionship&&$("#radio-championship-1").prop("checked",!0),"0"===p.inChampionship&&$("#radio-championship-0").prop("checked",!0),r("active")):r("disable"),p.enrol?(-1!==$.inArray("1",p.enrol)&&$("#canEnrol").prop("checked",!0),-1!==$.inArray("2",p.enrol)&&$("#isEnrol").prop("checked",!0),-1!==$.inArray("3",p.enrol)&&$("#participated").prop("checked",!0),c()):c()}function a(e,a){var i;i="all"!==e?$("#region-"+e).find(".cb-dep"):$("#region-container").find(".cb-dep"),"active"===a?i.prop("checked",!0):i.prop("checked",!1),t(e)}function t(e){var a=0,t=0,i=0,n=0,o=[],r=$("#switch-region-"+e),c=$("#switch-region-all"),p=$("#region-container").find(".switch-content");x.each(function(){var r=$(this).val(),c=$(this).attr("region");i++,c===e&&a++,this.checked&&(o.push(r),n++,c===e&&t++)}),0===t?s(r):t===a?l(r):d(r),0===n?p.each(function(){s($(this))}):n===i?p.each(function(){l($(this))}):d(c),0===n||n===i?u.dep=null:u.dep=o}function i(){var e=0,a=0,t=$("#switch-category"),i=[];w.each(function(){var t=$(this).val();e++,this.checked&&(i.push(t),a++)}),0===a?s(t):a===e?l(t):d(t),0===a||a===e?u.categories=null:u.categories=i}function n(e){var a=$("#distance-container");if("active"===e){var t=$("#distMin"),i=$("#distMax"),n=t.val(),o=i.val();a.css({opacity:1,"pointer-events":"auto"}),u.dist.min=n,u.dist.max=o,t.attr("max",o),i.attr("min",n)}else a.css({opacity:.5,"pointer-events":"none"}),u.dist.min=null,u.dist.max=null}function o(e){"active"===e?(k.css({opacity:1,"pointer-events":"auto"}),_.val()?(u.date.min=parseDateFrToUs(_.datepicker("getFormattedDate")),_.datepicker("setEndDate",j.datepicker("getDate"))):u.date.min=null,j.val()?(u.date.max=parseDateFrToUs(j.datepicker("getFormattedDate")),j.datepicker("setStartDate",_.datepicker("getDate"))):u.date.max=null):(k.css({opacity:.5,"pointer-events":"none"}),u.date.min=null,u.date.max=null)}function r(e){"active"===e?(y.css({opacity:1,"pointer-events":"auto"}),l($("#switch-championship")),$("#radio-championship-1").is(":checked")&&(u.inChampionship="1"),$("#radio-championship-0").is(":checked")&&(u.inChampionship="0")):(y.css({opacity:.5,"pointer-events":"none"}),u.inChampionship=null)}function c(){var e=0,a=0,t=$("#switch-competitor"),i=[];N.each(function(){e++,this.checked&&(i.push($(this).val()),a++)}),0===a?(s(t),u.enrol=null):(a===e?l(t):d(t),u.enrol=i)}function s(e){e.find(".info-slide").remove(),e.attr({"class":"switch-content disable",status:"active",initial:"0"})}function l(e){e.find(".info-slide").remove(),e.attr({"class":"switch-content active",status:"disable",initial:"0"})}function d(e){e.attr({status:"initial","class":"switch-content initial",initial:!0});var a=$('<span class="info-slide disable" title="tout supprimer"/>'),t=$('<span class="info-slide active" title="tout sélectionner"/>');e.append(a),e.append(t),a.hover(function(){e.addClass("disable"),e.removeClass("initial")},function(){e.addClass("initial"),e.removeClass("disable")}),t.hover(function(){e.addClass("active"),e.removeClass("initial")},function(){e.addClass("initial"),e.removeClass("active")}),t.click(function(){e.find(".info-slide").remove(),e.attr("initial","active")}),a.click(function(){e.find(".info-slide").remove(),e.attr("initial","disable")})}var p,u={categories:null,dep:null,dist:{min:null,max:null},date:{min:null,max:null},inChampionship:null,enrol:null},m=$("#data-search").val();p=m?JSON.parse(m):u;var h=$("#search-bar").find(".switch-content"),f=$("#category-container"),g=$("#region-container"),v=$("#distance-container"),k=$("#date-container"),y=$("#championship-container"),b=$("#competitor-container"),x=g.find(".cb-dep"),w=f.find("input"),D=v.find("input"),C=k.find("input"),S=y.find("input"),N=b.find("input"),_=k.find("#date-min"),j=k.find("#date-max");k.find(".datepicker").datepicker({language:"fr",format:"dd-mm-yyyy",todayBtn:"linked",autoclose:!0}),e(),h.click(function(){var e=$(this),t=e.attr("status"),d=e.attr("id").split("-"),p=e.attr("initial");switch("0"!==p&&(t=p,e.attr("initial","0")),d[1]){case"region":a(d[2],t);break;case"category":"active"===t?w.prop("checked",!0):w.prop("checked",!1),i();break;case"distance":n(t);break;case"date":o(t);break;case"championship":r(t);break;case"competitor":"active"===t?N.prop("checked",!0):N.prop("checked",!1),c()}switch(t){case"disable":s(e);break;case"active":l(e);break;case"initial":}}),x.click(function(){t($(this).attr("region"))}),w.click(function(){i()}),D.change(function(){n("active")}),C.on("changeDate",function(){o("active")}),S.click(function(){u.inChampionship=$(this).val()}),N.change(function(){c()}),$("#button-search").click(function(){var e=Routing.generate("races_search",{dataSearch:JSON.stringify(u)});window.location=e})}function competitorSearchRace(e){var a,t=todayDate();a="future"===e?{min:t,max:null}:{min:null,max:t};var i={categories:null,dep:null,dist:{min:null,max:null},date:a,inChampionship:null,enrol:["2","3"]},n=Routing.generate("races_search",{dataSearch:JSON.stringify(i)});window.location=n}function searchLayout(){function e(){var e=Routing.generate("competition_get_geojson");$.ajax({url:e,success:function(e){n=e,a(e)},error:function(){ajaxError()}})}function a(e){var a=i(e.futureCompetitions,s),t=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18});L.map("small-map",{center:[46.52863469527167,0],zoom:4,layers:[t,a]});c.css("visibility","visible")}function t(e){var a=L.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}),t=i(e.futureCompetitions,s),n=i(e.pastCompetitions,l),o=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}),r=L.map("index-map",{center:[46.52863469527167,2.43896484375],zoom:5,layers:[o,n,t]}),c={osmLayer:o,watercolorLayer:a},d={"A venir":t,"Passées":n};L.control.layers(c,d).addTo(r)}function i(e,a){return L.geoJSON(e,{pointToLayer:function(e,t){return L.marker(t,{icon:a})}}).bindPopup(function(e){return e.feature.properties.description})}searchBarRace(),panelCategoriesScroll();var n,o=$("#index-content"),r=($("#small-map"),$("#small-map-container"),$("#index-map"),$("#index-map-container")),c=$("#button-map"),s=L.icon({iconUrl:"/webSport/web/img/green.ico",iconSize:[30,30],iconAnchor:[11,31],popupAnchor:[5,-25]}),l=L.icon({iconUrl:"/webSport/web/img/pink.png",iconSize:[30,30],iconAnchor:[11,31],popupAnchor:[5,-25]});r.hide(),e(),c.click(function(){o.hide(),r.show(),"not-initialized"===$(this).val()&&(t(n),$(this).val("is-initialized"))}),$("#button-map-close").click(function(){r.hide(),o.show()})}function registration(){$(function(){var e=$("#gender-radio input"),a=$("#appbundle_competitor_gender");e.checkboxradio(),e.click(function(){this.checked&&(a.val($(this).val()),a.trigger("change"))})});var e=$("#appbundle_competitor_date"),a=$("#register-form-dp");a.datepicker({language:"fr",format:"dd-mm-yyyy",startView:2,autoclose:!0,todayHighlight:!0}),a.on("changeDate",function(){var t=parseDateFrToUs(a.datepicker("getFormattedDate"));e.val(t),e.trigger("change")})}function panelCategoriesScroll(){$(".panel-categories").mCustomScrollbar({snapAmount:40,scrollButtons:{enable:!0},keyboard:{scrollAmount:40},mouseWheel:{deltaFactor:40},scrollInertia:400,theme:"rounded-dark"})}function openNav(){document.getElementById("sidenav-organizer").style.width="11em",document.getElementById("main").style.marginLeft="11em",$(".sidenav-open").css("display","inline")}function closeNav(){document.getElementById("sidenav-organizer").style.width="0",document.getElementById("main").style.marginLeft="0"}function loaderStop(){$("#full-page").fadeOut(1e3)}function loaderDivStart(e){var a=$("#loader-div");a.height(e.height()),a.width(e.width()),e.hide(),a.show()}function loaderDivStop(e){var a=$("#loader-div");a.hide(),e.show()}function parseDateFrToUs(e){var a=new Date(e.split("-").reverse().join("-")),t=("0"+a.getDate()).slice(-2),i=a.getMonth()+1,i=("0"+i).slice(-2),n=a.getFullYear(),o=n+"-"+i+"-"+t;return o}function parseDateUsToFr(e){var a=new Date(e),t=("0"+a.getDate()).slice(-2),i=a.getMonth()+1,i=("0"+i).slice(-2),n=a.getFullYear(),o=t+"-"+i+"-"+n;return o}function todayDate(){var e=new Date,a=e.getDate(),t=e.getMonth()+1,i=e.getFullYear();return 10>a&&(a="0"+a),10>t&&(t="0"+t),e=i+"-"+t+"-"+a}function ajaxError(){$("#info").css("display","block"),$("#info span").text("Erreur requête ajax"),loaderStop()}var language={search:"Rechercher:",lengthMenu:"Voir _MENU_ compétiteurs  par page",zeroRecords:"Aucune inscription",paginate:{first:"Premier",last:"Dernier",next:"Suivant",previous:"précédent"}};$("#info-button").click(function(){location.reload(),$("#info").css("display","none")}),function(e){function a(e){switch(e){case"dep":i(),$.text("Département"),y.attr("placeholder","Ex : 06 Alpes-Maritimes"),b.val("depValidate"),loaderDivStop(k);break;case"depValidate":loaderDivStart(k),n();break;case"city":o(w),$.text("Ville"),y.attr("placeholder","Ex : nice"),b.val("cityValidate");break;case"cityValidate":loaderDivStart(k),r();break;case"address":c(C),$.text("Adresse"),y.attr("placeholder","Ex : 5 Promenade des Anglais"),b.val("addressValidate"),loaderDivStop(k);break;case"addressValidate":s();break;case"confirm":k.hide(),b.hide(),l()}y.focus()}function t(t){switch(y.val(""),k.show(),b.show(),_=!1,t){case"dep":e("#show_dep").remove(),w="";case"city":e("#show_city").remove(),C="";case"address":e("#show_address").remove(),S="","undefined"!=typeof N&&N.remove()}a(t),h.val(""),h.trigger("change")}function i(){e.get("/webSport/web/json/departements.json",function(a){y.autocomplete({source:a,messages:{noResults:"",results:function(){}},focus:function(){e(".ui-helper-hidden-accessible").hide()}})})}function n(){D=y.val(),w=D.slice(0,2),g.hide(),e.get("/webSport/web/json/departements.json",function(t){-1!==e.inArray(y.val(),t)?(d(y.val(),"dep"),y.val(""),a("city")):(a("dep"),g.text("Veuillez sélectionner un département dans la liste"),g.show())})}function o(a){var t=Routing.generate("address_getCitiesSlugByDep",{dep:a});e.ajax({url:t,success:function(a){var t=[];e.map(a,function(e){t.push(e.villeSlug)}),y.autocomplete({source:t,messages:{noResults:"",results:function(){}},focus:function(){e(".ui-helper-hidden-accessible").hide()}}),loaderDivStop(k),y.focus()}})}function r(){var t=y.val();y.val(""),g.hide(),e.ajax({url:Routing.generate("address_getCitiesData",{ville_slug:t}),dataType:"json",success:function(e){var i=e[0];e.length>0&&t==i.villeSlug?(d(i.villeNomReel,"city"),C=i.villeCodeCommune,a("address")):(a("city"),g.text("Veuillez sélectionner une commune dans la liste"),g.show())}})}function c(a){y.autocomplete({source:function(t,i){e.ajax({url:"https://api-adresse.data.gouv.fr/search/?citycode="+a,data:{q:t.term},dataType:"json",success:function(a){i(e.map(a.features,function(e){var a={label:e.properties.name,value:e.properties.name};return a})),autocompleteAddressList=a.features}})},messages:{noResults:"",results:function(){}},focus:function(){e(".ui-helper-hidden-accessible").hide()}})}function s(){e.ajax({url:"https://api-adresse.data.gouv.fr/search/?citycode="+C,data:{q:y.val()},dataType:"json",success:function(e){if(e.features.length>0&&e.features[0].properties.name==y.val()){var t=e.features[0];d(t.properties.name,"address"),p(t),g.hide(),a("confirm")}else g.text("Veuillez sélectionner une adresse dans la liste"),g.show(),a("address")},error:function(){ajaxError()}})}function l(){N=e("<div>",{id:"location-map"}),k.after(N),m(S.x,S.y,"location-map"),_=!0,h.val(JSON.stringify(S)),h.trigger("change")}function d(a,t){var i=e("<div>",{id:"show_"+t,"class":"form_show row "}),n=e("<p>",{"class":"col-xs-7"}).append(a),o=e("<button>",{"class":"col-xs-2 edit_bt btn btn-success btn-xs",value:t}).append("modifier");i.append(n),i.append(o),x.append(i)}function p(e){var a=e;S={id:a.properties.id,street:a.properties.name,depCode:w,dep:D,postCode:a.properties.postcode,cityCode:C,city:a.properties.city,x:a.geometry.coordinates[1],y:a.geometry.coordinates[0]}}function u(a){b.hide(),k.hide(),w=a.depCode,C=a.cityCode,d(a.dep,"dep"),d(a.city,"city"),d(a.street,"address"),N=e("<div>",{id:"location-map"}),k.after(N),m(a.x,a.y,"location-map"),_=!0}function m(e,a,t){var i=L.map(t,{center:[e,a],zoom:18});L.marker([e,a]).addTo(i),L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}).addTo(i)}var h,f=e("<div class='col-xs-offset-1 col-xs-6'>"),g=e("<div id='location_alert' class='alert alert-warning' role='alert' style='display: none'></div>"),v=e("<div class='loader-div'></div>"),k=e("<div id='location_form' class='form-group'>"),$=e("<label id='location_label'>Département</label>"),y=e("<input id='location_input' class='form-control' placeholder='Ex : 06 Alpes-Maritimes'>"),b=e("<button id='next_step_btn' class='col-xs-2  btn btn-primary btn-sm' value='depValidate'>Suivant</button>"),x=e("<div id='location-show' class='col-xs-5'></div>");e.fn.locationForm=function(a){var t={update:!1},n=e.extend(t,a);return h=n.output,k.append([$,y]),f.append([g,v,k,b,x]),this.append([f,x]),0!==h.val().length?(u(e.parseJSON(h.val())),this):(i(),this)};var w,D,C,S,N,_=!1;y.on("keyup",function(e){13===e.keyCode&&b.trigger("click")}),x.on("click","button",function(){t(e(this).val())}),b.click(function(){a(e(this).val())})}(jQuery),function(e){function a(){o.text(s.datepicker("getUTCDate").toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}function t(){var a=r.val(),t=c.val();e.isNumeric(a)&&e.isNumeric(t)?((a>23||0>a)&&r.val(n.defaultHour),(t>59||0>t)&&c.val(n.defaultMinute),i.val(s.datepicker("getFormattedDate")+" "+r.val()+":"+c.val()+":00")):(r.val(n.defaultHour),c.val(n.defaultMinute)),i.trigger("change")}var i,n,o=e("<div id='ocm-dt-date-show'></div>"),r=e("<input id='ocm-dt-hour' type='number' min='0' max='23' maxlength='2' required>"),c=e("<input id='ocm-dt-minute' type='number' min='0' max='59' maxlength='2' required>"),s=e("<div id='ocm-dt-datepicker'></div>");e.fn.ocmDateTime=function(l){var d={defaultHour:12,defaultMinute:30};n=e.extend(d,l),i=n.output;var p=e("<div class='n2 col-xs-5'></div>").append(r),u=e("<div class='n2 col-xs-offset-1 col-xs-1 '><span class='separator'>:</span></div>"),m=e("<div class='n2 col-xs-5'></div>").append(c),h=e("<div class='calendar-show '></div>").append(s),f=e("<div class=' col-xs-12 col-sm-offset-0 col-sm-4 calendar'>").append(h),g=e("<div id='ocm-dt-time' class='time-input col-xs-10'></div>").append([p,"<div class='n2 col-xs-1'></div>",u,m]),v=e("<div class='col-xs-12 col-sm-8'>").append([o,"<div class='col-xs-1'></div>",g]);return this.append([v,f]),s.datepicker({format:"yyyy-mm-dd",startDate:n.dateStart,endDate:n.dateEnd,language:"fr"}),s.datepicker("update",n.defaultDate),r.val(("0"+n.defaultHour).slice(-2)),c.val(("0"+n.defaultMinute).slice(-2)),a(),t(),this},s.on("changeDate",function(){a(),t()}),r.add(c).change(function(){e(this).val(("0"+e(this).val()).slice(-2)),t()})}(jQuery);